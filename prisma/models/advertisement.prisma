model AdUserInteraction {
  id              String        @id @default(uuid())
  advertisementId String
  userId          String?
  interactionType String
  timestamp       DateTime      @default(now())
  conversionValue Float?
  metadata        Json?
  deviceInfo      Json?
  ipAddress       String?
  referrer        String?
  productId       String?
  vendorId        String?
  advertisement   Advertisement @relation(fields: [advertisementId], references: [id], onDelete: Cascade)
  Product         Product?      @relation(fields: [productId], references: [id])
  user            User?         @relation(fields: [userId], references: [id])
  vendor          Vendor?       @relation(fields: [vendorId], references: [id])

  @@index([advertisementId])
  @@index([userId])
  @@index([vendorId])
  @@index([interactionType])
  @@index([timestamp])
}

model Advertisement {
  id               String                 @id @default(uuid())
  title            String
  description      String?
  vendorId         String
  startDate        DateTime?
  endDate          DateTime?
  budget           Float?
  reviewedBy       String?
  reviewedAt       DateTime?
  createdAt        DateTime               @default(now())
  updatedAt        DateTime               @updatedAt
  imageUrl         String?
  targetUrl        String?
  rejectionReason  String?
  videoUrl         String?
  adText           String?
  bidAmount        Float
  callToAction     String?
  dailyBudget      Float?
  landingPageUrl   String?
  mediaUrls        String[]
  pricingModel     PricingModel
  reviewNotes      String?
  spend            Float                  @default(0)
  type             AdType
  status           AdStatus               @default(DRAFT)
  maxProducts      Int                    @default(1)
  maxVendors       Int                    @default(1)
  analytics        AdAnalytics[]
  payments         AdPayment[]
  platformConfigs  AdPlatformConfig[]
  platformRefs     AdPlatformReference[]
  targeting        AdTargeting?
  userInteractions AdUserInteraction[]
  reviewer         User?                  @relation("AdReviewer", fields: [reviewedBy], references: [id])
  vendor           Vendor                 @relation(fields: [vendorId], references: [id])
  products         ProductAdvertisement[]
  clicks           AdClick[]
  conversions      AdConversion[]
  impressions      AdImpression[]

  @@index([vendorId])
  @@index([status])
  @@index([startDate])
  @@index([endDate])
}

model ProductAdvertisement {
  id                String        @id @default(uuid())
  advertisementId   String
  productId         String
  displayOrder      Int           @default(0)
  customTitle       String?
  customDescription String?
  customImageUrl    String?
  customPrice       Float?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  advertisement     Advertisement @relation(fields: [advertisementId], references: [id], onDelete: Cascade)
  product           Product       @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([advertisementId, productId])
  @@index([advertisementId])
  @@index([productId])
}

model AdTargeting {
  id               String        @id @default(uuid())
  advertisementId  String        @unique
  genders          String[]
  locations        String[]
  interests        String[]
  devices          String[]
  customAudience   Json?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  excludedAudience Json?
  languages        String[]
  maxAge           Int?
  minAge           Int?
  browsers         String[]
  keywords         String[]
  advertisement    Advertisement @relation(fields: [advertisementId], references: [id], onDelete: Cascade)
}

model AdPlatformConfig {
  id                  String        @id @default(uuid())
  isActive            Boolean       @default(true)
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  config              Json
  description         String?
  name                String
  advertisementId     String
  metadata            Json?
  platformAdId        String?
  platformCampaignId  String?
  platformClicks      Int           @default(0)
  platformConversions Int           @default(0)
  platformImpressions Int           @default(0)
  platformSpend       Float         @default(0)
  platformStatus      String?
  settings            Json?
  platform            AdPlatform
  advertisement       Advertisement @relation(fields: [advertisementId], references: [id], onDelete: Cascade)

  @@unique([advertisementId, platform, name])
}

model AdPlatformReference {
  id              String        @id @default(uuid())
  advertisementId String
  platform        String
  externalId      String
  status          String        @default("PENDING")
  metadata        Json?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  advertisement   Advertisement @relation(fields: [advertisementId], references: [id], onDelete: Cascade)

  @@unique([advertisementId, platform])
  @@index([platform])
  @@index([status])
}

model AdAnalytics {
  id                 String        @id @default(uuid())
  advertisementId    String
  date               DateTime
  clicks             Int           @default(0)
  conversions        Int           @default(0)
  ctr                Float?
  conversionRate     Float?
  views              Int           @default(0)
  conversionValue    Float         @default(0)
  timestamp          DateTime      @default(now())
  avgSessionDuration Float?
  bounceRate         Float?
  costPerClick       Float?
  costPerConversion  Float?
  createdAt          DateTime      @default(now())
  impressions        Int           @default(0)
  platform           AdPlatform
  spend              Float         @default(0)
  updatedAt          DateTime      @updatedAt
  advertisement      Advertisement @relation(fields: [advertisementId], references: [id], onDelete: Cascade)

  @@unique([advertisementId, date, platform])
  @@index([advertisementId])
  @@index([date])
}

model AdPayment {
  id                   String        @id @default(uuid())
  advertisementId      String
  amount               Float
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  currency             String?       @default("USD")
  notes                String?
  refundedAmount       Float?
  refundedAt           DateTime?
  processedAt          DateTime?
  transactionReference String?
  invoiceNumber        String?       @unique
  invoiceUrl           String?
  transactionId        String?
  status               PaymentStatus @default(PENDING)
  paymentMethod        PaymentMethod
  advertisement        Advertisement @relation(fields: [advertisementId], references: [id])

  @@index([advertisementId])
  @@index([status])
  @@index([createdAt])
}

enum AdStatus {
  DRAFT
  PENDING_APPROVAL
  ACTIVE
  PAUSED
  REJECTED
  COMPLETED
  ARCHIVED
}

enum AdType {
  FEATURED_PRODUCT
  IN_APP_BANNER
  IN_APP_POPUP
  EXTERNAL
  CAROUSEL
  FEATURED_VENDOR
}

enum PricingModel {
  CPC
  CPM
  CPV
  FIXED
}

enum AdPlatform {
  IN_APP
  FACEBOOK
  INSTAGRAM
  TWITTER
  WHATSAPP
  GOOGLE_ADSENSE
  TIKTOK
  LINKEDIN
  PINTEREST
  OTHER
}
