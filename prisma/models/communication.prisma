model Notification {
  id        String           @id @default(uuid())
  userId    String
  type      NotificationType
  title     String
  message   String
  isRead    Boolean          @default(false)
  data      Json?
  createdAt DateTime         @default(now())
  orderId   String?
  Order     Order?           @relation(fields: [orderId], references: [id])
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model Conversation {
  id            String    @id @default(uuid())
  participants  String[]
  lastMessage   String?
  lastMessageAt DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  messages      Message[]

  @@map("conversations")
}

model Message {
  id             String            @id @default(uuid())
  senderId       String
  content        String
  isRead         Boolean           @default(false)
  createdAt      DateTime          @default(now())
  attachments    String[]          @default([])
  conversationId String
  editedAt       DateTime?
  isEdited       Boolean           @default(false)
  messageType    MessageType       @default(TEXT)
  replyToId      String?
  updatedAt      DateTime          @updatedAt
  deliveredAt    DateTime?
  isDelivered    Boolean           @default(false)
  reactions      MessageReaction[]
  conversation   Conversation      @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  replyTo        Message?          @relation("MessageReplies", fields: [replyToId], references: [id])
  replies        Message[]         @relation("MessageReplies")
  sender         User              @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)

  @@map("messages")
}

model MessageReaction {
  id        String   @id @default(uuid())
  messageId String
  userId    String
  emoji     String
  createdAt DateTime @default(now())
  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user      User     @relation("MessageReactions", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId, emoji])
  @@map("message_reactions")
}

enum MessageType {
  TEXT
  IMAGE
  FILE
  VOICE
  VIDEO
}

enum NotificationType {
  ORDER_STATUS
  PAYMENT
  PROMOTION
  SYSTEM
  DELIVERY
}
